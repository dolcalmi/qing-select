/* qing-select v0.0.1 | (c) Mycolorway Design | MIT License */
!function(t,e){"object"==typeof module&&module.exports?module.exports=e(require("jquery"),require("qing-module")):t.QingSelect=e(t.jQuery,t.QingModule)}(this,function(t,e){var i=require=function t(e,i,n){function r(s,p){if(!i[s]){if(!e[s]){var l="function"==typeof require&&require;if(!p&&l)return l(s,!0);if(o)return o(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var c=i[s]={exports:{}};e[s][0].call(c.exports,function(t){var i=e[s][1][t];return r(i?i:t)},c,c.exports,t,e,i,n)}return i[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(i,n,r){var o,s=function(t,e){function i(){this.constructor=t}for(var n in e)p.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},p={}.hasOwnProperty;o=function(e){function i(e){i.__super__.constructor.apply(this,arguments),t.extend(this.opts,i.opts,e),this.el=t(this.opts.el)}return s(i,e),i.opts={el:null},i.prototype.getOptions=function(){var e;return e=[],this.el.find("option").each(function(i){return function(i,n){var r,o,s;if(r=t(n),s=r.val())return o=r.data(),r.is(":selected")&&(o.selected=!0),e.push([r.text(),s,o])}}(this)),e},i.prototype.selectOption=function(t){return this.el.find("option[value='"+t.value+"']").length>0||this.el.append(this._renderOption(t)),this.el.val(t.value),this},i.prototype.unselectOption=function(t){var e;return e=this.el.find("option[value='"+t.value+"']"),e.prop("selected",!1),this},i.prototype._renderOption=function(e){return t("<option>",{text:e.name,value:e.value,data:e.data})},i.prototype.getValue=function(){return this.el.val()},i.prototype.setValue=function(t){return this.el.val(t),this},i.prototype.getBlankOption=function(){var t;return t=this.el.find('option:not([value]), option[value=""]'),t.length>0&&t},i}(e),n.exports=o},{}],2:[function(i,n,r){var o,s,p=function(t,e){function i(){this.constructor=t}for(var n in e)l.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},l={}.hasOwnProperty;s=i("./option.coffee"),o=function(e){function i(e){var n;i.__super__.constructor.apply(this,arguments),t.extend(this.opts,i.opts,e),this.remote=this.opts.remote,this.options=function(){var t,e,i,r;for(i=this.opts.options,r=[],t=0,e=i.length;t<e;t++)n=i[t],r.push(new s(n));return r}.call(this),this.totalSize=this.opts.totalSize}return p(i,e),i.opts={remote:!1,options:[],totalOptionSize:null},i.prototype._fetch=function(e,i){var n,r;if(this.remote&&this.trigger("beforeFetch")!==!1)return r=function(t){return function(n){var r,o;return o=function(){var t,e,i,o;for(i=n.options,o=[],t=0,e=i.length;t<e;t++)r=i[t],o.push(new s(r));return o}(),t.trigger("fetch",[o,n.totalSize,e]),null!=i?i.call(t,o,n.totalSize):void 0}}(this),t.ajax({url:this.remote.url,data:t.extend({},this.remote.params,(n={},n[""+this.remote.searchKey]=e,n)),dataType:"json"}).done(function(t){return r(t)})},i.prototype.filter=function(e,i){var n,r;return n=function(t){return function(n,r){return n=n.filter(function(t,e){return!t.selected}),null!=i&&i.call(t,n,r),t.trigger("filter",[n,r,e])}}(this),this.remote?e?this._fetch(e,n):n(this.options,this.totalSize):(r=[],t.each(this.options,function(t,i){if(i.match(e))return r.push(i)}),n(r,r.length)),null},i}(e),n.exports=o},{"./option.coffee":3}],3:[function(i,n,r){var o,s=function(t,e){function i(){this.constructor=t}for(var n in e)p.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},p={}.hasOwnProperty;o=function(e){function i(e){this.name=e[0],this.value=e[1].toString(),this.data={},e.length>2&&t.isArray(e[2])&&t.each(e[2],function(e){return function(i,n){return i=i.replace(/^data-/,"").split("-"),t.each(i,function(t,e){if(t>0)return i[t]=e.charAt(0).toUpperCase()+e.slice(1)}),e.data[i.join("")]=n,null}}(this)),this.selected=this.data.selected||!1}return s(i,e),i.prototype.match=function(t){var e,i,n;try{n=new RegExp("(^|\\s)"+t,"i")}catch(t){e=t,n=new RegExp("","i")}return i=this.data.searchKey||this.name,n.test(i)},i}(e),n.exports=o},{}],4:[function(i,n,r){var o,s=function(t,e){function i(){this.constructor=t}for(var n in e)p.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},p={}.hasOwnProperty;o=function(e){function i(e){i.__super__.constructor.apply(this,arguments),t.extend(this.opts,i.opts,e),this.wrapper=t(this.opts.wrapper),this.wrapper.length>0&&(this.active=!1,this.disabled=!1,this.selected=[],this._render(),this._bind(),this.opts.selected&&this.addSelected(this.opts.selected))}return s(i,e),i.opts={wrapper:null,placeholder:"",selected:!1},i.prototype._render=function(){return this.el=t('<div class="result-box">\n  <a class="link-add" href="javascript:;" tabindex="0">+</a>\n</div>').appendTo(this.wrapper),this.linkAdd=this.el.find(".link-add")},i.prototype._bind=function(){return this.el.on("click",".link-add",function(t){return function(e){if(!t.disabled)return t.trigger("addClick")}}(this)),this.el.on("click",".selected-option",function(e){return function(i){var n;if(!e.disabled)return n=t(i.currentTarget),e.trigger("optionClick",[n.data("option")])}}(this)),this.linkAdd.on("keydown",function(t){return function(e){var i;if(!t.disabled)return 13===(i=e.which)||38===i||40===i?t.trigger("addClick"):void 0}}(this))},i.prototype.addSelected=function(e){var i,n,r;{if(!t.isArray(e))return t('<a href="javascript:;" class="selected-option" data-value="'+e.value+'">\n  '+e.name+"\n</a>").data("option",e).insertBefore(this.linkAdd),this.selected.push(e),this;for(i=0,n=e.length;i<n;i++)r=e[i],this.addSelected(r)}},i.prototype.removeSelected=function(t){var e,i,n,r,o,s;for(this.el.find(".selected-option[data-value='"+t.value+"']").remove(),i=-1,s=this.selected,e=n=0,r=s.length;n<r;e=++n)if(o=s[e],t.value===o.value){i=e;break}return i>-1&&this.selected.splice(i,1),this},i.prototype.setActive=function(t){if(t!==this.active)return this.el.toggleClass("active",t),this.active=t,this},i.prototype.setDisabled=function(t){if(t!==this.disabled)return this.el.toggleClass("disabled",t),this.disabled=t,this},i}(e),n.exports=o},{}],5:[function(i,n,r){var o,s=function(t,e){function i(){this.constructor=t}for(var n in e)p.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},p={}.hasOwnProperty;o=function(e){function i(e){i.__super__.constructor.apply(this,arguments),t.extend(this.opts,i,e),this.wrapper=t(this.opts.wrapper),this.wrapper.length>0&&(this.highlighted=!1,this._render(),this._bind())}return s(i,e),i.opts={wrapper:null,locales:null,options:null,totalOptionSize:null,maxListSize:0},i.prototype._render=function(){if(this.el=t('<div class="options-list"></div>').appendTo(this.wrapper),this.opts.options)return this.renderOptions(this.opts.options,this.opts.totalOptionSize)},i.prototype._bind=function(){return this.el.on("click",".option",function(e){return function(i){var n;return n=t(i.currentTarget),e.setHighlighted(n),e.trigger("optionClick",[n]),null}}(this))},i.prototype.renderOptions=function(t,e){var i;return null==t&&(t=[]),t=t.slice(0,this.opts.maxListSize),this.el.empty(),this.highlighted=!1,t.length>0?this.el.append(function(){var e,n,r;for(r=[],e=0,n=t.length;e<n;e++)i=t[e],r.push(this._optionEl(i));return r}.call(this)):e||this._renderEmpty(),e&&e>t.length&&this._renderHiddenSize(e-t.length),this.setHighlighted(this.el.find(".option:first"))},i.prototype._optionEl=function(e){var i;return i=t('<div class="option">\n  <span class="label"></span>\n  <span class="hint"></span>\n</div>').data("option",e),i.find(".label").text(e.name),e.data.hint&&i.find(".hint").text(e.data.hint),i.attr("data-value",e.value),i.data("option",e),t.isFunction(this.opts.opitonRenderer)&&this.opts.opitonRenderer.call(this,i,e),i},i.prototype._renderEmpty=function(){return this.el.append('<div class="no-options">'+this.opts.locales.noOptions+"</div>")},i.prototype._renderHiddenSize=function(t){var e;return e=this.opts.locales.hiddenSize.replace(/\{\{\s?size\s?\}\}/g,t),this.el.append('<div class="hidden-size">'+e+"</div>")},i.prototype.setHighlighted=function(t){if("object"!=typeof t&&(t=this.el.find(".option[data-value='"+t+"']")),t.length>0)return this.highlighted&&this.highlighted.removeClass("highlighted"),this.highlighted=t.addClass("highlighted"),this},i.prototype.highlightNextOption=function(){var t;if(t=this.highlighted?this.highlighted.next(".option"):this.el.find(".option:first"),t.length>0)return this.setHighlighted(t)},i.prototype.highlightPrevOption=function(){var t;if(t=this.highlighted?this.highlighted.prev(".option"):this.el.find(".option:first"),t.length>0)return this.setHighlighted(t)},i}(e),n.exports=o},{}],6:[function(i,n,r){var o,s,p,l=function(t,e){function i(){this.constructor=t}for(var n in e)h.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},h={}.hasOwnProperty;p=i("./search-box.coffee"),o=i("./options-list.coffee"),s=function(e){function i(e){i.__super__.constructor.apply(this,arguments),t.extend(this.opts,p.opts,e),this.wrapper=t(this.opts.wrapper),this.wrapper.length>0&&(this.active=!1,this.dataProvider=this.opts.dataProvider,this._render(),this._initChildComponents(),this._bind())}return l(i,e),i.opts={wrapper:null,dataProvider:null,locales:null,maxListSize:0},i.prototype._render=function(){return this.el=t('<div class="popover">').appendTo(this.wrapper)},i.prototype._initChildComponents=function(){return this.searchBox=new p({wrapper:this.el,placeholder:this.opts.locales.searchPlaceholder}),this.optionsList=new o({wrapper:this.el,locales:this.opts.locales,options:this.dataProvider.options,totalOptionSize:this.dataProvider.totalOptionSize,maxListSize:this.opts.maxListSize})},i.prototype._bind=function(){return this.searchBox.on("change",function(t){return function(e,i){return t.dataProvider.filter(i,function(e,i){return t.optionsList.renderOptions(e,i)})}}(this)),this.searchBox.on("enterPress",function(t){return function(e){if(t.optionsList.highlighted)return t._selectOption(t.optionsList.highlighted)}}(this)),this.searchBox.on("arrowPress",function(t){return function(e,i){return"up"===i?t.optionsList.highlightPrevOption():"down"===i?t.optionsList.highlightNextOption():void 0}}(this)),this.optionsList.on("optionClick",function(t){return function(e,i){return t._selectOption(i)}}(this))},i.prototype._selectOption=function(t){var e;return e=t.data("option"),this.searchBox.setValue(""),this.optionsList.setHighlighted(e.value),this.trigger("select",[e])},i.prototype.setActive=function(t){if(t!==this.active)return this.el.toggleClass("active",t),this.searchBox.focus(),this.active=t,this},i}(e),n.exports=s},{"./options-list.coffee":5,"./search-box.coffee":8}],7:[function(i,n,r){var o,s=function(t,e){function i(){this.constructor=t}for(var n in e)p.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},p={}.hasOwnProperty;o=function(e){function i(e){i.__super__.constructor.apply(this,arguments),t.extend(this.opts,i.opts,e),this.wrapper=t(this.opts.wrapper),this.wrapper.length>0&&(this.active=!1,this.disabled=!1,this._render(),this._bind(),this.setSelected(this.opts.selected))}return s(i,e),i.opts={wrapper:null,placeholder:"",selected:!1},i.prototype._render=function(){return this.el=t('<div class="result-box" tabindex="0">\n  <div class="placeholder">'+this.opts.placeholder+'</div>\n  <div class="result"></div>\n  <i class="icon-expand"><span>&#9662;</span></i>\n  <a class="link-clear" href="javascript:;" tabindex="-1">\n    &#10005;\n  </a>\n</div>').appendTo(this.wrapper)},i.prototype._bind=function(){return this.el.on("click",function(t){return function(e){if(!t.disabled)return t.trigger("click")}}(this)),this.el.on("click",".link-clear",function(t){return function(e){if(!t.disabled)return t.trigger("clearClick")}}(this)),this.el.on("keydown",function(t){return function(e){var i;if(!t.disabled)return 13===(i=e.which)||38===i||40===i?t.trigger("click"):void 0}}(this))},i.prototype.setSelected=function(t){if(t!==this.selected)return t?this.el.removeClass("empty").find(".result").text(t.name):this.el.addClass("empty").find(".result").text(""),this.selected=t,this},i.prototype.setActive=function(t){if(t!==this.active)return this.el.toggleClass("active",t),this.active=t,this},i.prototype.setDisabled=function(t){if(t!==this.disabled)return this.el.toggleClass("disabled",t),t?this.el.removeAttr("tabindex"):this.el.attr("tabindex","0"),this.disabled=t,this},i}(e),n.exports=o},{}],8:[function(i,n,r){var o,s=function(t,e){function i(){this.constructor=t}for(var n in e)p.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},p={}.hasOwnProperty;o=function(e){function i(e){i.__super__.constructor.apply(this,arguments),t.extend(this.opts,i.opts,e),this.wrapper=t(this.opts.wrapper),this.wrapper.length>0&&(this._inputDelay=200,this._render(),this._bind())}return s(i,e),i.opts={wrapper:null,placeholder:""},i.prototype._render=function(){return this.el=t('<div class="search-box">\n  <input type="text" class="text-field" tabindex="-1"\n    placeholder="'+this.opts.placeholder+'" />\n  <span class="icon-search">&#128269;</span>\n  <a href="javascript:;" class="link-clear" tabindex="-1">X</a>\n</div>').appendTo(this.wrapper),this.textField=this.el.find(".text-field"),this.el},i.prototype._bind=function(){return this.textField.on("input",function(t){return function(e){return t._inputTimer&&(clearTimeout(t._inputTimer),t._inputTimer=null),t._inputTimer=setTimeout(function(){return t.trigger("change",[t.textField.val()])},t._inputDelay)}}(this)),this.textField.on("keydown",function(t){return function(e){return 13===e.which?t.trigger("enterPress"):38===e.which?t.trigger("arrowPress",["up"]):40===e.which&&t.trigger("arrowPress",["down"]),null}}(this)),this.el.on("click",".link-clear",function(t){return function(e){return t.textField.val(""),t.trigger("change",[""])}}(this)),this.on("change",function(t,e){return this.el.toggleClass("empty",!!e)})},i.prototype.getValue=function(){return this.textField.val()},i.prototype.setValue=function(t){return this.textField.val(t),this.trigger("change",[t]),this},i}(e),n.exports=o},{}],"qing-select":[function(i,n,r){var o,s,p,l,h,c,a=function(t,e){function i(){this.constructor=t}for(var n in e)u.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},u={}.hasOwnProperty;o=i("./models/data-provider.coffee"),s=i("./html-select.coffee"),p=i("./multiple-result-box.coffee"),c=i("./result-box.coffee"),l=i("./popover.coffee"),h=function(e){function i(e){if(i.__super__.constructor.apply(this,arguments),this.el=t(this.opts.el),!(this.el.length>0))throw new Error("QingSelect: option el is required");this.opts=t.extend({},i.opts,this.opts),this.locales=t.extend({},i.locales,this.opts.locales),this.active=!1,this._render(),this._initChildComponents(),this._bind()}return a(i,e),i.name="QingSelect",i.opts={el:null,remote:!1,totalOptionSize:null,maxListSize:20,locales:null},i.locales={searchPlaceholder:"Search",noOptions:"Found nothing.",hiddenSize:"{{ size }} more records are hidden, please search for them."},i.prototype._render=function(){return this.wrapper=t('<div class="qing-select"></div>').insertBefore(this.el),this.el.addClass(" qing-select").appendTo(this.wrapper).data("qingSelect",this)},i.prototype._initChildComponents=function(){var t,e;return this.htmlSelect=new s({el:this.el}),t=this.htmlSelect.getOptions(),this.dataProvider=new o({remote:this.opts.remote,options:t,totalOptionSize:this.opts.totalOptionSize||t.length}),this.multiple=this.el.is("[multiple]"),e=this.dataProvider.options.filter(function(t){return t.selected}),this.resultBox=this.multiple?new p({wrapper:this.wrapper,placeholder:this._placeholder(),selected:e}):new c({wrapper:this.wrapper,placeholder:this._placeholder(),selected:e.length>0&&e[0]}),this.popover=new l({wrapper:this.wrapper,dataProvider:this.dataProvider,locales:this.locales,maxListSize:this.opts.maxListSize})},i.prototype._bind=function(){return this.multiple?(this.resultBox.on("addClick",function(t){return function(e){return t._setActive(!0)}}(this)),this.resultBox.on("optionClick",function(t){return function(e,i){return t.unselectOption(i)}}(this))):(this.resultBox.on("click",function(t){return function(e){return t._setActive(!t.active)}}(this)),this.resultBox.on("clearClick",function(t){return function(e){if(t.resultBox.selected)return t.unselectOption(t.resultBox.selected)}}(this))),this.popover.on("select",function(t){return function(e,i){return t.selectOption(i)}}(this))},i.prototype._placeholder=function(){var t;return this.placeholder||(this.placeholder=this.opts.placeholder?this.opts.placeholder:(t=this.htmlSelect.getBlankOption())?t.text():"")},i.prototype._setActive=function(e){if(e!==this.active)return this.resultBox.setActive(e),this.popover.setActive(e),t(document).off(".qing-select"),e&&t(document).one("mousedown.qing-select",function(e){return function(i){if(i.target!==e.el[0]&&!t.contains(e.el[0],i.target))return e._setActive(!1)}}(this)),this.active=e,this},i.prototype.selectOption=function(t){return this.multiple?this.resultBox.addSelected(t):this.resultBox.setSelected(t),this.htmlSelect.selectOption(t),this._setActive(!1),this},i.prototype.unselectOption=function(t){return this.multiple?this.resultBox.removeSelected(t):this.resultBox.setSelected(!1),this.htmlSelect.unselectOption(t),this._setActive(!1),this},i.prototype.destroy=function(){return this.el.empty().removeData("qingSelect"),t(document).off(".qing-select"),this},i}(e),n.exports=h},{"./html-select.coffee":1,"./models/data-provider.coffee":2,"./multiple-result-box.coffee":4,"./popover.coffee":6,"./result-box.coffee":7}]},{},[]);return i("qing-select")});